<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road Accident Data Visualization - CIPAT Assignment</title>
    
    <!-- CDN Links -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        header p {
            color: #666;
            font-size: 14px;
        }
        
        main {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        section h2 {
            color: #764ba2;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .chart-container {
            margin-top: 20px;
            min-height: 400px;
        }
        
        .tech-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üöó Road Accident Analysis Dashboard</h1>
        <p><strong>CIPAT Assignment - Task B: Data Visualization Tools</strong></p>
        <p>Course: Data Visualization (3160717) | C. K. Pithawala College</p>
        <p>Demonstrating Google Charts, CanvasJS, D3.js, and HTML5 Canvas</p>
    </header>
    
    <main>
        <!-- Google Charts Section -->
        <section>
            <h2>üìä Google Charts API <span class="tech-badge">Technology 1</span></h2>
            <div class="chart-grid">
                <div id="google-bar-chart" class="chart-container"></div>
                <div id="google-pie-chart" class="chart-container"></div>
            </div>
        </section>
        
        <!-- CanvasJS Section -->
        <section>
            <h2>üìà CanvasJS <span class="tech-badge">Technology 2</span></h2>
            <div id="canvasjs-chart" class="chart-container"></div>
        </section>
        
        <!-- D3.js Section -->
        <section>
            <h2>üé® D3.js (SVG) <span class="tech-badge">Technology 3</span></h2>
            <div id="d3-chart" class="chart-container"></div>
        </section>
        
        <!-- HTML5 Canvas Section -->
        <section>
            <h2>üñåÔ∏è HTML5 Canvas (Manual Drawing) <span class="tech-badge">Technology 4</span></h2>
            <canvas id="html5-canvas" width="1200" height="400"></canvas>
        </section>
    </main>

    <script>
        /*
         * ============================================================================
         * DATASET DESCRIPTION & VISUALIZATION STRATEGY
         * ============================================================================
         * 
         * DATASET: UK Road Accident Statistics (2018-2024)
         * 
         * ATTRIBUTES:
         * 1. year (numerical/temporal) - Year of accident occurrence
         * 2. severity (categorical) - Fatal, Serious, or Slight injury
         * 3. count (numerical) - Number of accidents
         * 4. vehicleType (categorical) - Car, Motorcycle, Bicycle, Truck, Pedestrian
         * 5. location (categorical) - Urban or Rural area
         * 
         * CHART TYPE JUSTIFICATIONS:
         * 
         * 1. GOOGLE CHARTS - Bar Chart (Accidents by Severity):
         *    - Categorical comparison of accident severities
         *    - Bar charts excel at comparing discrete categories
         *    - Easy to see which severity level is most common
         * 
         * 2. GOOGLE CHARTS - Pie Chart (Vehicle Type Distribution):
         *    - Shows proportional distribution of accidents by vehicle type
         *    - Pie charts ideal for part-to-whole relationships
         *    - Reveals which vehicle types are involved most frequently
         * 
         * 3. CANVASJS - Line Chart (Yearly Accident Trends):
         *    - Temporal data showing trends over time
         *    - Line charts best for continuous time-series data
         *    - Shows whether accidents are increasing/decreasing over years
         * 
         * 4. D3.JS - Bar Chart (Urban vs Rural Comparison):
         *    - Comparing two distinct location categories
         *    - Demonstrates D3's data binding and SVG manipulation
         *    - Shows geographic distribution pattern
         * 
         * 5. HTML5 CANVAS - Bar Chart (Accidents by Year):
         *    - Manual pixel-level drawing demonstration
         *    - Same temporal data as CanvasJS but different representation
         *    - Shows low-level Canvas API capabilities
         * 
         * KEY INSIGHTS FROM THE DATA:
         * - Slight injuries are most common (~70%), followed by Serious (~25%), Fatal (~5%)
         * - Cars are involved in majority of accidents (~60%), motorcycles second (~20%)
         * - Overall accident trend shows gradual decline from 2018 to 2024
         * - Urban areas have approximately 2x more accidents than rural areas
         * - Peak accidents were in 2018 (180k), lowest in 2024 (130k)
         * ============================================================================
         */

        // DATASET: Road Accident Data (realistic subset)
        const roadAccidentData = {
            // Accidents by Severity (aggregated across all years)
            bySeverity: [
                { severity: 'Fatal', count: 9500 },
                { severity: 'Serious', count: 48000 },
                { severity: 'Slight', count: 142500 }
            ],
            
            // Accidents by Vehicle Type (aggregated)
            byVehicleType: [
                { type: 'Car', count: 120000 },
                { type: 'Motorcycle', count: 35000 },
                { type: 'Bicycle', count: 18000 },
                { type: 'Truck', count: 15000 },
                { type: 'Pedestrian', count: 12000 }
            ],
            
            // Accidents by Year (time series)
            byYear: [
                { year: 2018, count: 180000 },
                { year: 2019, count: 175000 },
                { year: 2020, count: 145000 },  // COVID-19 impact
                { year: 2021, count: 155000 },
                { year: 2022, count: 165000 },
                { year: 2023, count: 150000 },
                { year: 2024, count: 130000 }
            ],
            
            // Accidents by Location
            byLocation: [
                { location: 'Urban', count: 133000 },
                { location: 'Rural', count: 67000 }
            ]
        };

        // ============================================================================
        // GOOGLE CHARTS IMPLEMENTATION
        // ============================================================================
        
        google.charts.load('current', { packages: ['corechart'] });
        google.charts.setOnLoadCallback(drawGoogleCharts);

        function drawGoogleCharts() {
            drawGoogleBarChart();
            drawGooglePieChart();
        }

        function drawGoogleBarChart() {
            // Prepare data for bar chart
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Severity');
            data.addColumn('number', 'Number of Accidents');
            data.addColumn({ type: 'string', role: 'style' });
            
            // Add data with custom colors
            data.addRows([
                ['Fatal', roadAccidentData.bySeverity[0].count, '#d32f2f'],
                ['Serious', roadAccidentData.bySeverity[1].count, '#f57c00'],
                ['Slight', roadAccidentData.bySeverity[2].count, '#fbc02d']
            ]);

            const options = {
                title: 'Road Accidents by Severity Level',
                titleTextStyle: { fontSize: 18, bold: true },
                legend: { position: 'none' },
                hAxis: {
                    title: 'Severity Category',
                    titleTextStyle: { fontSize: 14, italic: false }
                },
                vAxis: {
                    title: 'Number of Accidents',
                    titleTextStyle: { fontSize: 14, italic: false },
                    format: 'short'
                },
                chartArea: { width: '70%', height: '70%' },
                animation: { startup: true, duration: 1000, easing: 'out' }
            };

            const chart = new google.visualization.ColumnChart(
                document.getElementById('google-bar-chart')
            );
            chart.draw(data, options);
        }

        function drawGooglePieChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Vehicle Type');
            data.addColumn('number', 'Accidents');
            
            roadAccidentData.byVehicleType.forEach(item => {
                data.addRow([item.type, item.count]);
            });

            const options = {
                title: 'Accident Distribution by Vehicle Type',
                titleTextStyle: { fontSize: 18, bold: true },
                pieHole: 0.4,  // Donut chart
                colors: ['#1976d2', '#388e3c', '#f57c00', '#7b1fa2', '#c2185b'],
                chartArea: { width: '90%', height: '75%' },
                legend: { position: 'right', textStyle: { fontSize: 12 } },
                pieSliceText: 'percentage',
                tooltip: { text: 'both' }
            };

            const chart = new google.visualization.PieChart(
                document.getElementById('google-pie-chart')
            );
            chart.draw(data, options);
        }

        // ============================================================================
        // CANVASJS IMPLEMENTATION
        // ============================================================================

        function drawCanvasJSChart() {
            const dataPoints = roadAccidentData.byYear.map(item => ({
                label: item.year.toString(),
                y: item.count
            }));

            const chart = new CanvasJS.Chart("canvasjs-chart", {
                animationEnabled: true,
                theme: "light2",
                title: {
                    text: "Road Accident Trends Over Years (2018-2024)",
                    fontSize: 20
                },
                axisX: {
                    title: "Year",
                    interval: 1,
                    labelFontSize: 12
                },
                axisY: {
                    title: "Number of Accidents",
                    includeZero: false,
                    labelFormatter: function(e) {
                        return (e.value / 1000) + "k";
                    }
                },
                data: [{
                    type: "line",
                    indexLabelFontSize: 12,
                    xValueFormatString: "####",
                    yValueFormatString: "#,##0",
                    dataPoints: dataPoints,
                    lineThickness: 3,
                    markerSize: 8,
                    markerType: "circle",
                    color: "#667eea"
                }],
                toolTip: {
                    shared: true,
                    content: "Year {label}: {y} accidents"
                }
            });
            
            chart.render();
        }

        // ============================================================================
        // D3.JS IMPLEMENTATION
        // ============================================================================

        function drawD3Chart() {
            const margin = { top: 50, right: 30, bottom: 70, left: 80 };
            const width = 600 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            // Clear any existing SVG
            d3.select("#d3-chart").selectAll("*").remove();

            const svg = d3.select("#d3-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Prepare data
            const data = roadAccidentData.byLocation;

            // X Scale
            const x = d3.scaleBand()
                .domain(data.map(d => d.location))
                .range([0, width])
                .padding(0.3);

            // Y Scale
            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.count) * 1.1])
                .range([height, 0]);

            // Color scale
            const color = d3.scaleOrdinal()
                .domain(['Urban', 'Rural'])
                .range(['#764ba2', '#667eea']);

            // Add X axis
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("font-size", "14px");

            // Add Y axis
            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => (d / 1000) + "k"))
                .selectAll("text")
                .style("font-size", "12px");

            // Add X axis label
            svg.append("text")
                .attr("text-anchor", "middle")
                .attr("x", width / 2)
                .attr("y", height + 50)
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .text("Location Type");

            // Add Y axis label
            svg.append("text")
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .attr("y", -60)
                .attr("x", -height / 2)
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .text("Number of Accidents");

            // Add title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -20)
                .attr("text-anchor", "middle")
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .text("Urban vs Rural Road Accidents");

            // Create tooltip
            const tooltip = d3.select("#d3-chart")
                .append("div")
                .style("position", "absolute")
                .style("background", "rgba(0,0,0,0.8)")
                .style("color", "white")
                .style("padding", "10px")
                .style("border-radius", "5px")
                .style("pointer-events", "none")
                .style("opacity", 0);

            // Add bars
            svg.selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", d => x(d.location))
                .attr("y", height)
                .attr("width", x.bandwidth())
                .attr("height", 0)
                .attr("fill", d => color(d.location))
                .on("mouseover", function(event, d) {
                    tooltip.transition().duration(200).style("opacity", 1);
                    tooltip.html(`<strong>${d.location}</strong><br/>Accidents: ${d.count.toLocaleString()}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 30) + "px");
                    d3.select(this).style("opacity", 0.7);
                })
                .on("mouseout", function() {
                    tooltip.transition().duration(200).style("opacity", 0);
                    d3.select(this).style("opacity", 1);
                })
                .transition()
                .duration(1000)
                .attr("y", d => y(d.count))
                .attr("height", d => height - y(d.count));

            // Add value labels on bars
            svg.selectAll(".label")
                .data(data)
                .enter()
                .append("text")
                .attr("class", "label")
                .attr("x", d => x(d.location) + x.bandwidth() / 2)
                .attr("y", d => y(d.count) - 10)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", "#333")
                .text(d => (d.count / 1000).toFixed(0) + "k");
        }

        // ============================================================================
        // HTML5 CANVAS IMPLEMENTATION (Manual Drawing)
        // ============================================================================

        function drawCanvasChart() {
            const canvas = document.getElementById('html5-canvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Configuration
            const padding = { top: 80, right: 50, bottom: 80, left: 100 };
            const chartWidth = canvas.width - padding.left - padding.right;
            const chartHeight = canvas.height - padding.top - padding.bottom;
            
            const data = roadAccidentData.byYear;
            const maxValue = Math.max(...data.map(d => d.count));
            const barWidth = chartWidth / data.length - 20;
            
            // Helper function to get color gradient
            function getGradient(ctx, x, y, height) {
                const gradient = ctx.createLinearGradient(x, y + height, x, y);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                return gradient;
            }
            
            // Draw title
            ctx.fillStyle = '#333';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Road Accidents by Year (HTML5 Canvas)', canvas.width / 2, 40);
            
            // Draw Y-axis
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, padding.top + chartHeight);
            ctx.stroke();
            
            // Draw X-axis
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top + chartHeight);
            ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);
            ctx.stroke();
            
            // Draw Y-axis label
            ctx.save();
            ctx.translate(30, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.font = 'bold 14px Arial';
            ctx.fillStyle = '#333';
            ctx.textAlign = 'center';
            ctx.fillText('Number of Accidents', 0, 0);
            ctx.restore();
            
            // Draw X-axis label
            ctx.font = 'bold 14px Arial';
            ctx.fillStyle = '#333';
            ctx.textAlign = 'center';
            ctx.fillText('Year', canvas.width / 2, canvas.height - 20);
            
            // Draw Y-axis ticks and labels
            ctx.font = '12px Arial';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const value = (maxValue / 5) * i;
                const y = padding.top + chartHeight - (chartHeight / 5) * i;
                
                // Tick mark
                ctx.beginPath();
                ctx.moveTo(padding.left - 5, y);
                ctx.lineTo(padding.left, y);
                ctx.stroke();
                
                // Label
                ctx.fillText((value / 1000).toFixed(0) + 'k', padding.left - 10, y + 5);
                
                // Grid line
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(padding.left + chartWidth, y);
                ctx.stroke();
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
            }
            
            // Draw bars
            data.forEach((item, index) => {
                const barHeight = (item.count / maxValue) * chartHeight;
                const x = padding.left + (chartWidth / data.length) * index + 
                         (chartWidth / data.length - barWidth) / 2;
                const y = padding.top + chartHeight - barHeight;
                
                // Draw bar with gradient
                ctx.fillStyle = getGradient(ctx, x, y, barHeight);
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Draw bar border
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, y, barWidth, barHeight);
                
                // Draw value on bar
                ctx.fillStyle = '#333';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText((item.count / 1000).toFixed(0) + 'k', x + barWidth / 2, y - 10);
                
                // Draw year label
                ctx.fillStyle = '#666';
                ctx.font = '14px Arial';
                ctx.fillText(item.year, x + barWidth / 2, padding.top + chartHeight + 30);
            });
            
            // Draw legend
            ctx.fillStyle = '#f5f5f5';
            ctx.fillRect(canvas.width - 220, 10, 200, 50);
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.strokeRect(canvas.width - 220, 10, 200, 50);
            
            const legendGradient = ctx.createLinearGradient(canvas.width - 210, 0, canvas.width - 210, 30);
            legendGradient.addColorStop(0, '#667eea');
            legendGradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = legendGradient;
            ctx.fillRect(canvas.width - 210, 20, 30, 30);
            
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Total Accidents', canvas.width - 170, 40);
        }

        // ============================================================================
        // INITIALIZE ALL CHARTS
        // ============================================================================

        // CanvasJS, D3, and Canvas charts can be called immediately
        window.addEventListener('load', function() {
            drawCanvasJSChart();
            drawD3Chart();
            drawCanvasChart();
        });

        // Handle window resize for responsive charts
        window.addEventListener('resize', function() {
            // Redraw Google Charts
            if (typeof google !== 'undefined' && google.visualization) {
                drawGoogleCharts();
            }
            // Redraw CanvasJS
            drawCanvasJSChart();
            // Redraw D3
            drawD3Chart();
            // Redraw Canvas
            drawCanvasChart();
        });
    </script>
</body>
</html>
